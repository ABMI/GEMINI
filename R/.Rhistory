schema="mimiciii")
con <- DatabaseConnector::connect(connectionDetails)
db_adm <- querySQL(con,"SELECT * FROM ADMISSIONS")
?querySQL
??querySQL
library(DatabaseConnector)
db_adm <- querySQL(con,"SELECT * FROM ADMISSIONS")
??querySQL
library(DatabaseConnector)
db_adm <- DatabaseConnector::querySql(con,"SELECT * FROM ADMISSIONS")
db_adm
db_cout <- DatabaseConnector::querySql(con,"SELECT * FROM CALLOUT")
db_cgive <- DatabaseConnector::querySql(con,"SELECT * FROM CAREGIVERS")
origin_adm <- read.csv(file = paste(dataFolder,"ADMISSIONS.csv"),header = T)
origin_adm <- read.csv(file = paste(dataFolder,"/ADMISSIONS.csv"),header = T)
origin_adm <- read.csv(file = paste0(dataFolder,"/ADMISSIONS.csv"),header = T)
origin_cout <- read.csv(file = paste0(dataFolder,"/CALLOUT.csv"),header = T)
origin_cgive <- read.csv(file = paste0(dataFolder,"/CAREGIVERS.csv"),header = T)
str(db_adm)
str(origin_adm)
if(db_adm == origin_adm){
print("Correct Admission Data")
}else{
print("Incorrect Admission")
}
if(all.equal(db_adm,origin_adm)){
print("Correct Admission Data")
}else{
print("Incorrect Admission")
}
all.equal(db_adm,origin_adm)
str(db_adm)
str(origin_adm)
db_cout
str(db_cout)
str(origin_cout)
str(db_cgive)
str(origin_cgive
)
db_adm <- DatabaseConnector::querySql(con,"SELECT * FROM ADMISSIONS")
db_adm
origin_adm <- read.csv(file = paste0(dataFolder,"/ADMISSIONS.csv"),header = T)
str(db_adm)
str(origin_adm)
?list.files
paste0(athenaFolder,fileLists[2]
)
athenaFolder = "C:/Users/K.JunHyeong/Documents/mimic/mimic-omop/data/vocab/"
fileLists <- list.files(athenaFolder, full.names = FALSE,pattern = "*.csv")
paste0(athenaFolder,fileLists[2])
paste0(athenaFolder,fileLists[3])
temp <- read.csv(file= paste0(athenaFolder,fileLists[3]),header = T, sep=",")
temp
temp2 <- read.csv(file= paste0(athenaFolder,fileLists[4]),header = T, sep=",")
temp2
fileLists[4]
temp2 <- read.csv(file= paste0(athenaFolder,fileLists[5]),header = T, sep=",")
temp2 <- read.csv(file= paste0(athenaFolder,fileLists[10]),header = T, sep=",")
temp2
temp <- read.csv(file= paste0(athenaFolder,fileLists[1]),header = T, sep="\t")
athenaFolder = "C:/Users/K.JunHyeong/Documents/mimic/mimic-omop/data/vocab/"
fileLists <- list.files(athenaFolder, full.names = FALSE,pattern = "*.csv")
temp <- read.csv(file= paste0(athenaFolder,fileLists[3]),header = T, sep=",\t")
temp <- read.csv(file= paste0(athenaFolder,fileLists[3]),header = T, sep="\t")
temp
load("~/.RData")
dataFolder <- "C:/Users/K.JunHyeong/Documents/MIMIC/mimic-omop/data/vocab/"
dataFolder
fileLists <- list.files(dataFolder, full.names = FALSE)
fileLists
fileLists <- list.files(dataFolder, full.names = FALSE, pattern = "*.csv")
fileLists
fileLists
rowNum<-R.utils::countLines(file.path(dataFolder, fileLists[7]))[[1]]
rowNum
fileLists[7]
fileLists[8]
rowNum<-R.utils::countLines(file.path(dataFolder, fileLists[8]))[[1]]
rowNum
rowNum<-R.utils::countLines(file.path(dataFolder, fileLists[1]))[[1]]
rowNum
rowNum<-R.utils::countLines(file.path(dataFolder, fileLists[9]))[[1]]
rowNum
dataFolder <- "C:/Users/K.JunHyeong/Documents/MIMIC/mimic-omop/data/vocab/"
fileLists <- list.files(dataFolder, full.names = FALSE, pattern = "*.csv")
fileLists
rowNum<-R.utils::countLines(file.path(dataFolder, fileLists[7]))[[1]]
source('~/mimic/mimic-omop/etl/ConceptTables/loadTables.R', echo=TRUE)
source('~/mimic/mimic-omop/etl/ConceptTables/loadTables.R', echo=TRUE)
warnings()
source('~/R project/gemini_upload/R/DrawChart.R', echo=TRUE)
source('~/R project/gemini_upload/R/DrawChart.R', echo=TRUE)
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
source('~/R project/gemini_upload/R/DrawChart.R', echo=TRUE)
source('~/R project/gemini_upload/R/GetData.R', echo=TRUE)
source('~/R project/gemini_upload/R/DrawChart.R', echo=TRUE)
par(mfrow = c(1, 1), xpd = T)
jpeg(
filename = "../images/Whole/00.Record.jpg",
width = 720, height = 720, quality = 75, bg = "white"
)
record_bar <- barplot(c(
std_persontbl_record$ratio[1], tar_persontbl_record$ratio[1], std_visittbl_record$ratio[1], tar_visittbl_record$ratio[1],
std_conditiontbl_record$ratio[1], tar_conditiontbl_record$ratio[1], std_drug_exptbl_record$ratio[1], tar_drug_exptbl_record$ratio[1],
std_drug_eratbl_record$ratio[1], tar_drug_eratbl_record$ratio[1]
),
beside = F, names = c(
"Person", NA, "Visit", NA, "Condition", NA,
"Drug exp", NA, "Drug era", NA
),
ylim = c(0, 100), col = c("Green", "Yellow"), main = "Record by hospital", xlab = "Table name", ylab = "Percentage (%)", cex.axis = 1.5, cex.names = 1.5,
cex.main = 2.0, cex.lab = 1.5
)
text(
x = record_bar, y = c(
std_persontbl_record$ratio[1], tar_persontbl_record$ratio[1], std_visittbl_record$ratio[1], tar_visittbl_record$ratio[1],
std_conditiontbl_record$ratio[1], tar_conditiontbl_record$ratio[1], std_drug_exptbl_record$ratio[1], tar_drug_exptbl_record$ratio[1],
std_drug_eratbl_record$ratio[1], tar_drug_eratbl_record$ratio[1]
),
labels = c(
label_sort(std_persontbl_record$ratio[1], tar_persontbl_record$ratio[1]),
label_sort(std_visittbl_record$ratio[1], tar_visittbl_record$ratio[1]),
label_sort(std_conditiontbl_record$ratio[1], tar_conditiontbl_record$ratio[1]),
label_sort(std_drug_exptbl_record$ratio[1], tar_drug_exptbl_record$ratio[1]),
label_sort(std_drug_eratbl_record$ratio[1], tar_drug_eratbl_record$ratio[1])
), col = "black", cex = 2.0
)
legend("topleft", c("Standard CDM", "Target CDM"), pch = 15, cex = 1.5, col = c("green", "yellow"))
# dev.copy(device = jpeg , filename=paste0())
dev.off()
std_persontbl_record
tar_persontbl_record
std_visittbl_record
################################################################################
# WHOLE TABLE info VISUALLIZATION
################################################################################
################################################################################
# WHOLE TABLE Record info
################################################################################
par(mfrow = c(1, 1), xpd = T)
jpeg(
filename = "../images/Whole/00.Record.jpg",
width = 720, height = 720, quality = 75, bg = "white"
)
record_bar <- barplot(c(
std_persontbl_record$ratio[1], tar_persontbl_record$ratio[1], std_visittbl_record$ratio[1], tar_visittbl_record$ratio[1],
std_conditiontbl_record$ratio[1], tar_conditiontbl_record$ratio[1], std_drug_exptbl_record$ratio[1], tar_drug_exptbl_record$ratio[1],
std_drug_eratbl_record$ratio[1], tar_drug_eratbl_record$ratio[1]
),
beside = F, names = c(
"Person", NA, "Visit", NA, "Condition", NA,
"Drug exp", NA, "Drug era", NA
),
ylim = c(0, 100), col = c("Green", "Yellow"), main = "Record by hospital", xlab = "Table name", ylab = "Percentage (%)", cex.axis = 1.5, cex.names = 1.5,
cex.main = 2.0, cex.lab = 1.5
)
text(
x = record_bar, y = c(
std_persontbl_record$ratio[1], tar_persontbl_record$ratio[1], std_visittbl_record$ratio[1], tar_visittbl_record$ratio[1],
std_conditiontbl_record$ratio[1], tar_conditiontbl_record$ratio[1], std_drug_exptbl_record$ratio[1], tar_drug_exptbl_record$ratio[1],
std_drug_eratbl_record$ratio[1], tar_drug_eratbl_record$ratio[1]
),
labels = c(
label_sort(std_persontbl_record$ratio[1], tar_persontbl_record$ratio[1]),
label_sort(std_visittbl_record$ratio[1], tar_visittbl_record$ratio[1]),
label_sort(std_conditiontbl_record$ratio[1], tar_conditiontbl_record$ratio[1]),
label_sort(std_drug_exptbl_record$ratio[1], tar_drug_exptbl_record$ratio[1]),
label_sort(std_drug_eratbl_record$ratio[1], tar_drug_eratbl_record$ratio[1])
), col = "black", cex = 2.0
)
legend("topleft", c("Standard CDM", "Target CDM"), pch = 15, cex = 1.5, col = c("green", "yellow"))
# dev.copy(device = jpeg , filename=paste0())
dev.off()
record_bar <- barplot(c(
std_persontbl_record$ratio[1], tar_persontbl_record$ratio[1], std_visittbl_record$ratio[1], tar_visittbl_record$ratio[1],
std_conditiontbl_record$ratio[1], tar_conditiontbl_record$ratio[1], std_drug_exptbl_record$ratio[1], tar_drug_exptbl_record$ratio[1],
std_drug_eratbl_record$ratio[1], tar_drug_eratbl_record$ratio[1]
),
beside = F, names = c(
"Person", NA, "Visit", NA, "Condition", NA,
"Drug exp", NA, "Drug era", NA
),
ylim = c(0, 100), col = c("Green", "Yellow"), main = "Record by hospital", xlab = "Table name", ylab = "Percentage (%)", cex.axis = 1.5, cex.names = 1.5,
cex.main = 2.0, cex.lab = 1.5
)
################################################################################
# WHOLE TABLE info VISUALLIZATION
################################################################################
################################################################################
# WHOLE TABLE Record info
################################################################################
par(mfrow = c(1, 1), xpd = T)
jpeg(
filename = "../images/Whole/00.Record.jpg",
width = 720, height = 720, quality = 75, bg = "white"
)
record_bar <- barplot(c(
std_persontbl_record$ratio[1], tar_persontbl_record$ratio[1], std_visittbl_record$ratio[1], tar_visittbl_record$ratio[1],
std_conditiontbl_record$ratio[1], tar_conditiontbl_record$ratio[1], std_drug_exptbl_record$ratio[1], tar_drug_exptbl_record$ratio[1],
std_drug_eratbl_record$ratio[1], tar_drug_eratbl_record$ratio[1]
),
beside = F, names = c(
"Person", NA, "Visit", NA, "Condition", NA,
"Drug exp", NA, "Drug era", NA
),
ylim = c(0, 100), col = c("Green", "Yellow"), main = "Record by hospital", xlab = "Table name", ylab = "Percentage (%)", cex.axis = 1.5, cex.names = 1.5,
cex.main = 2.0, cex.lab = 1.5
)
text(
x = record_bar, y = c(
std_persontbl_record$ratio[1], tar_persontbl_record$ratio[1], std_visittbl_record$ratio[1], tar_visittbl_record$ratio[1],
std_conditiontbl_record$ratio[1], tar_conditiontbl_record$ratio[1], std_drug_exptbl_record$ratio[1], tar_drug_exptbl_record$ratio[1],
std_drug_eratbl_record$ratio[1], tar_drug_eratbl_record$ratio[1]
),
labels = c(
label_sort(std_persontbl_record$ratio[1], tar_persontbl_record$ratio[1]),
label_sort(std_visittbl_record$ratio[1], tar_visittbl_record$ratio[1]),
label_sort(std_conditiontbl_record$ratio[1], tar_conditiontbl_record$ratio[1]),
label_sort(std_drug_exptbl_record$ratio[1], tar_drug_exptbl_record$ratio[1]),
label_sort(std_drug_eratbl_record$ratio[1], tar_drug_eratbl_record$ratio[1])
), col = "black", cex = 2.0
)
legend("topleft", c("Standard CDM", "Target CDM"), pch = 15, cex = 1.5, col = c("green", "yellow"))
# dev.copy(device = jpeg , filename=paste0())
dev.off()
record_bar <- barplot(c(
std_persontbl_record$ratio[1], tar_persontbl_record$ratio[1], std_visittbl_record$ratio[1], tar_visittbl_record$ratio[1],
std_conditiontbl_record$ratio[1], tar_conditiontbl_record$ratio[1], std_drug_exptbl_record$ratio[1], tar_drug_exptbl_record$ratio[1],
std_drug_eratbl_record$ratio[1], tar_drug_eratbl_record$ratio[1]
),
beside = F, names = c(
"Person", NA, "Visit", NA, "Condition", NA,
"Drug exp", NA, "Drug era", NA
),
ylim = c(0, 100), col = c("Green", "Yellow"), main = "Record by hospital", xlab = "Table name", ylab = "Percentage (%)", cex.axis = 1.5, cex.names = 1.5,
cex.main = 2.0, cex.lab = 1.5
)
text(
x = record_bar, y = c(
std_persontbl_record$ratio[1], tar_persontbl_record$ratio[1], std_visittbl_record$ratio[1], tar_visittbl_record$ratio[1],
std_conditiontbl_record$ratio[1], tar_conditiontbl_record$ratio[1], std_drug_exptbl_record$ratio[1], tar_drug_exptbl_record$ratio[1],
std_drug_eratbl_record$ratio[1], tar_drug_eratbl_record$ratio[1]
),
labels = c(
label_sort(std_persontbl_record$ratio[1], tar_persontbl_record$ratio[1]),
label_sort(std_visittbl_record$ratio[1], tar_visittbl_record$ratio[1]),
label_sort(std_conditiontbl_record$ratio[1], tar_conditiontbl_record$ratio[1]),
label_sort(std_drug_exptbl_record$ratio[1], tar_drug_exptbl_record$ratio[1]),
label_sort(std_drug_eratbl_record$ratio[1], tar_drug_eratbl_record$ratio[1])
), col = "black", cex = 2.0
)
legend("topleft", c("Standard CDM", "Target CDM"), pch = 15, cex = 1.5, col = c("green", "yellow"))
# dev.copy(device = jpeg , filename=paste0())
dev.off()
# dev.copy(device = jpeg , filename=paste0())
dev.off()
################################################################################
# WHOLE TABLE Person info
################################################################################
par(mfrow = c(1, 1))
jpeg(
filename = "../images/Whole/00.Record.jpg",
width = 720, height = 720, quality = 75, bg = "white"
)
record_bar <- barplot(c(
std_persontbl_record$ratio[1], tar_persontbl_record$ratio[1], std_visittbl_record$ratio[1], tar_visittbl_record$ratio[1],
std_conditiontbl_record$ratio[1], tar_conditiontbl_record$ratio[1], std_drug_exptbl_record$ratio[1], tar_drug_exptbl_record$ratio[1],
std_drug_eratbl_record$ratio[1], tar_drug_eratbl_record$ratio[1]
),
beside = F, names = c(
"Person", NA, "Visit", NA, "Condition", NA,
"Drug exp", NA, "Drug era", NA
),
ylim = c(0, 100), col = c("Green", "Yellow"), main = "Record by hospital", xlab = "Table name", ylab = "Percentage (%)", cex.axis = 1.5, cex.names = 1.5,
cex.main = 2.0, cex.lab = 1.5
)
text(
x = record_bar, y = c(
std_persontbl_record$ratio[1], tar_persontbl_record$ratio[1], std_visittbl_record$ratio[1], tar_visittbl_record$ratio[1],
std_conditiontbl_record$ratio[1], tar_conditiontbl_record$ratio[1], std_drug_exptbl_record$ratio[1], tar_drug_exptbl_record$ratio[1],
std_drug_eratbl_record$ratio[1], tar_drug_eratbl_record$ratio[1]
),
labels = c(
label_sort(std_persontbl_record$ratio[1], tar_persontbl_record$ratio[1]),
label_sort(std_visittbl_record$ratio[1], tar_visittbl_record$ratio[1]),
label_sort(std_conditiontbl_record$ratio[1], tar_conditiontbl_record$ratio[1]),
label_sort(std_drug_exptbl_record$ratio[1], tar_drug_exptbl_record$ratio[1]),
label_sort(std_drug_eratbl_record$ratio[1], tar_drug_eratbl_record$ratio[1])
), col = "black", cex = 2.0
)
legend("topleft", c("Standard CDM", "Target CDM"), pch = 15, cex = 1.5, col = c("green", "yellow"))
# dev.copy(device = jpeg , filename=paste0())
dev.off()
################################################################################
# WHOLE TABLE info VISUALLIZATION
################################################################################
################################################################################
# WHOLE TABLE Record info
################################################################################
par(mfrow = c(1, 1), xpd = T)
jpeg(
filename = "../images/Whole/00.Record.jpg",
width = 720, height = 720, quality = 75, bg = "white"
)
record_bar <- barplot(c(
std_persontbl_record$ratio[1], tar_persontbl_record$ratio[1], std_visittbl_record$ratio[1], tar_visittbl_record$ratio[1],
std_conditiontbl_record$ratio[1], tar_conditiontbl_record$ratio[1], std_drug_exptbl_record$ratio[1], tar_drug_exptbl_record$ratio[1],
std_drug_eratbl_record$ratio[1], tar_drug_eratbl_record$ratio[1]
),
beside = F, names = c(
"Person", NA, "Visit", NA, "Condition", NA,
"Drug exp", NA, "Drug era", NA
),
ylim = c(0, 100), col = c("Green", "Yellow"), main = "Record by hospital", xlab = "Table name", ylab = "Percentage (%)", cex.axis = 1.5, cex.names = 1.5,
cex.main = 2.0, cex.lab = 1.5
)
text(
x = record_bar, y = c(
std_persontbl_record$ratio[1], tar_persontbl_record$ratio[1], std_visittbl_record$ratio[1], tar_visittbl_record$ratio[1],
std_conditiontbl_record$ratio[1], tar_conditiontbl_record$ratio[1], std_drug_exptbl_record$ratio[1], tar_drug_exptbl_record$ratio[1],
std_drug_eratbl_record$ratio[1], tar_drug_eratbl_record$ratio[1]
),
labels = c(
label_sort(std_persontbl_record$ratio[1], tar_persontbl_record$ratio[1]),
label_sort(std_visittbl_record$ratio[1], tar_visittbl_record$ratio[1]),
label_sort(std_conditiontbl_record$ratio[1], tar_conditiontbl_record$ratio[1]),
label_sort(std_drug_exptbl_record$ratio[1], tar_drug_exptbl_record$ratio[1]),
label_sort(std_drug_eratbl_record$ratio[1], tar_drug_eratbl_record$ratio[1])
), col = "black", cex = 2.0
)
legend("topleft", c("Standard CDM", "Target CDM"), pch = 15, cex = 1.5, col = c("green", "yellow"))
# dev.copy(device = jpeg , filename=paste0())
dev.off()
source('~/R project/Gemini/R/DrawChart.R', echo=TRUE)
std_conditiontbl_stop
tar_conditiontbl_stop
################################################################################
# condition_occurrence stop_reason
################################################################################
draw_count_bar(std_conditiontbl_stop, tar_conditiontbl_stop, "Condition stop reason", "Condition/06.Condition Stop.jpg")
################################################################################
# condition_occurrence stop_reason
################################################################################
draw_count_bar(std_conditiontbl_stop, tar_conditiontbl_stop, "Condition stop reason", "Condition/06.Condition_Stop.jpg")
std_conditiontbl_stop
################################################################################
# condition_occurrence stop_reason
################################################################################
draw_ratio_bar(std_conditiontbl_stop, tar_conditiontbl_stop, "Condition stop reason", "Condition/06.Condition_Stop.jpg")
draw_ratio_bar(std_conditiontbl_stop, tar_conditiontbl_stop, "Condition stop reason", "Condition/06.Condition_Stop.jpg")
################################################################################
# condition_occurrence stop_reason
################################################################################
draw_ratio_bar(std_conditiontbl_stop, tar_conditiontbl_stop, "Condition/06.Condition_Stop.jpg")
# Graph Save
dev.off() # It protect previous jpg file to not change current jpg image.
std_conditiontbl_stop
get_reason_count("condition_occurrence")
source('~/R project/gemini_upload/R/SaveData.R', echo=TRUE)
source('~/R project/gemini_upload/R/GetData.R', echo=TRUE)
draw_ratio_bar(std_conditiontbl_stop, tar_conditiontbl_stop, "Condition/06.Condition_Stop.jpg")
std_conditiontbl_stop
tar_conditiontbl_stop
# library(DatabaseConnector)
# Set CDM name
cdmDatabaseSchema <- "Dolphin_CDM.dbo"
# Set User Info to check authority
connectionDetails <- DatabaseConnector::createConnectionDetails(
dbms = "sql server",
server = "128.1.99.58",
schema = cdmDatabaseSchema,
user = "imblock",
password = "blackcherry7&"
)
# connectionDetails<- DatabaseConnector::createConnectionDetails(
#  dbms="sql server",
#  server="128.1.99.53",
#  schema=cdmDatabaseSchema,
#  user="imblock",
#  password="blackcherry7&"
# )
# Connect CDM using Details
connection <- DatabaseConnector::connect(connectionDetails)
################################################################################
# Get data from stop_reason
################################################################################
tryCatch({
conditiontbl_stop <- get_reason_count("stop_reason")
}, error = function(e) {
conditiontbl_stop <<- NULL
})
conditiontbl_stop
get_reason_count("stop_reason")
conditiontbl_stop
get_reason_count("stop_reason")
drug_exptbl_stop
get_reason_count("drug_exposure")
conditiontbl_stop <- get_reason_count("condition_occurrence")
conditiontbl_stop <- get_reason_count("condition_occurrence")
get_reason_count("condition_occurrence")
conditiontbl_stop <- get_reason_count("condition_occurrence")
drug_exptbl_stop <- get_reason_count("drug_exposure")
################################################################################
# Get data from stop_reason
################################################################################
tryCatch({
drug_exptbl_stop <- get_reason_count("drug_exposure")
}, error = function(e) {
drug_exptbl_stop <<- NULL
})
drug_exptbl_stop
get_reason_count("drug_exposure")
################################################################################
# Get Data Setting
################################################################################
# install.packages("DatabaseConnector")
# set working directory
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
# library(DatabaseConnector)
# Set CDM name
cdmDatabaseSchema <- "Dolphin_CDM.dbo"
# Set User Info to check authority
connectionDetails <- DatabaseConnector::createConnectionDetails(
dbms = "sql server",
server = "128.1.99.58",
schema = cdmDatabaseSchema,
user = "imblock",
password = "blackcherry7&"
)
# connectionDetails<- DatabaseConnector::createConnectionDetails(
#  dbms="sql server",
#  server="128.1.99.53",
#  schema=cdmDatabaseSchema,
#  user="imblock",
#  password="blackcherry7&"
# )
# Connect CDM using Details
connection <- DatabaseConnector::connect(connectionDetails)
################################################################################
# Get data from stop_reason
################################################################################
tryCatch({
conditiontbl_stop <- get_reason_count("condition_occurrence")
}, error = function(e) {
conditiontbl_stop <<- NULL
})
conditiontbl_stop
get_reason_count("condition_occurrence")
################################################################################
# Loading Function
################################################################################
source("gemini.r")
get_reason_count("condition_occurrence")
get_reason_count("condition_occurrence")
get_compared_ratio("condition_occurrence", "visit_occurrence_id", "condition_occurrence_id")
# Count stop reason
get_reason_count <- function(tblName) {
sql <<- "select 'stop reason' as attribute_name ,count(distinct stop_reason) as attribute_count
from @cdm_database_schema.@tblName"
return(queryRender(sql, tblName))
}
conditiontbl_stop <- get_reason_count("condition_occurrence")
sql <<- "select 'stop reason' as attribute_name ,count(distinct stop_reason) as attribute_count
from @cdm_database_schema.@tblName"
return(queryRender(sql, tblName))
tblName <- condition_occurrence
return(queryRender(sql, tblName))
tblName <- condition_occurrence
tblName <- "condition_occurrence"
return(queryRender(sql, tblName))
# sql query Render
queryRender <- function(sqlquery, tblName = "", AttName = "", comparedAttName = "", startName = "", endName = "") {
# Unset parameter call warning message
options(warn = -1)
sql <- SqlRender::renderSql(sql,
cdm_database_schema = cdmDatabaseSchema, tbl_name = tblName, att_name = AttName,
compared_att_name = comparedAttName, start_name = startName, end_name = endName
)$sql
options(warn = 1)
sql <- SqlRender::translateSql(sql, targetDialect = attr(connection, "dbms"))$sql
temp <- DatabaseConnector::querySql(connection, sql)
# Colname change
colnames(temp) <- SqlRender::snakeCaseToCamelCase(colnames(temp))
return(temp)
}
sql <<- "select 'stop reason' as attribute_name ,count(distinct stop_reason) as attribute_count
from @cdm_database_schema.@tblName"
tblName <- "condition_occurrence"
return(queryRender(sql, tblName))
queryRender(sql, tblName)
Sys.setlocale("LC_ALL", "C")
queryRender(sql, tblName)
get_reason_count("drug_exposure")
drug_exptbl_stop <- get_reason_count("drug_exposure")
drug_exptbl_stop <- get_reason_count("drug_exposure")
drug_exptbl_stop <- get_reason_count("drug_exposure")
drug_exptbl_stop <- get_reason_count("drug_exposure")
drug_exptbl_stop <- get_reason_count("drug_exposure")
drug_exptbl_stop <- get_reason_count("drug_exposure")
drug_exptbl_stop <- get_reason_count("drug_exposure")
drug_exptbl_stop <- get_reason_count("drug_exposure")
get_reason_count("drug_exposure")
drug_exptbl_stop <- get_reason_count("drug_exposure")
get_reason_count("drug_exposure")
sql <<- "select 'stop reason' as attribute_name ,count(distinct stop_reason) as attribute_count
from @cdm_database_schema.@tbl_name"
tblName <- "condition_occurrence"
queryRender(sql, tblName)
drug_exptbl_stop <- get_reason_count("drug_exposure")
get_reason_count("condition_occurrence")
conditiontbl_stop <- get_reason_count("condition_occurrence")
source('~/R project/gemini_upload/R/SaveData.R', echo=TRUE)
